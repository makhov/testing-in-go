–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Go
GoWay Meetup v1.3

–ê–ª–µ–∫—Å–µ–π –ú–∞—Ö–æ–≤
Avito
@makhov
amakhov@avito.ru
: 3 –æ—Ñ —è–∑—ã–∫–∞, –∫–∞–∫ –≤ –ò—Å–ª–∞–Ω–¥–∏–∏: –∏—Å–ª–∞–Ω–¥—Å–∫–∏–π, –∞–Ω–≥–ª –∏ —è–∑—ã–∫ –∂–µ—Å—Ç–æ–≤. –ù—É –¥–∞, –º—ã –µ—â–µ –ø–∏—à–µ–º –Ω–∞ PHP.
: –û–∫-–æ–∫, —ç—Ç–æ —à—É—Ç–∫–∞ ‚Äì –∞–Ω–≥–ª –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ—Ñ —è–∑—ã–∫–æ–º –≤ –ò—Å–ª–∞–Ω–¥–∏–∏

* –û —á–µ–º –ø–æ–≥–æ–≤–æ—Ä–∏–º
- stdlib
- go test
- practice & tips & tricks
- open source

* test
`*_test.go`

* test
`*_test.go`
.code testing_in_go/foo_test.go /IMPORT OMIT/,/TEST OMIT/

* test
`*_test.go`
.code testing_in_go/foo_test.go /IMPORT OMIT/,/END OMIT/ HLFUNC

* testing
: Presenter notes (first paragraph)

* testing
.code testing_in_go/foo_test.go /IMPORT OMIT/,/TEST OMIT/
- *testing.T
- *testing.B

* testing
.code testing_in_go/stdlib/testing/testing.go /TB START OMIT/,/TB END OMIT/ HLTB

* testing
.code testing_in_go/stdlib/testing/testing.go /TB START OMIT/,/TB END OMIT/ HLTBPR

* *testing.T ‚ö†Ô∏è
.code testing_in_go/stdlib/testing/testing.go /TB START OMIT/,/TB END OMIT/ HLFAIL

: Fail –∏ FailNow

* *testing.T
.code testing_in_go/stdlib/testing/testing.go /TB START OMIT/,/TB END OMIT/ HLERRFAT

: Error –∏ Fatal

* *testing.T ‚ùå
.code testing_in_go/stdlib/testing/testing.go /TB START OMIT/,/TB END OMIT/ HLSKIP

: Skip

* *testing.T
- t.Run(name string, f func (*testing.T)) bool
- t.Parallel()

: –ò–º—è + `go test -run=TestName`
: –ó–∞–ø—É—Å–∫–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é –≥–æ—Ä—É—Ç–∏–Ω—É

* –¢–∞–±–ª–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã

* –¢–∞–±–ª–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
.code testing_in_go/foo_test.go /TABLETEST OMIT/,/END OMIT/

* –¢–∞–±–ª–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
.code testing_in_go/foo_test.go /TABLETEST OMIT/,/END OMIT/ HLTC

* –¢–∞–±–ª–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
.code testing_in_go/foo_test.go /TABLETEST OMIT/,/END OMIT/ HLFOR

* –¢–∞–±–ª–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚ùå
.code testing_in_go/foo_test.go /TABLETEST OMIT/,/END OMIT/ HLFMT

* –¢–∞–±–ª–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚úÖ
.code testing_in_go/foo_test.go /TABLERIGHTWAYTEST OMIT/,/END OMIT/ HLTC

* –¢–∞–±–ª–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚úÖ
.code testing_in_go/foo_test.go /TBLNUMS OMIT/,/END OMIT/ HLTC

* –¢–∞–±–ª–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚úÖ
.code testing_in_go/foo_test.go /TBLNUMSRES OMIT/,/END OMIT/ HLTC

* –¢–∞–±–ª–∏—á–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚úÖ
.code testing_in_go/foo_test.go /TABLERIGHTWAYTESTWITHPARALLEL OMIT/,/END OMIT/ HLP

* t.Parallel() + t.FailNow() ‚ö†Ô∏è
.code testing_in_go/stdlib/testing/testing.go /TFAILNOW OMIT/,/END OMIT/ HLEXIT

* t.Parallel() + t.FailNow() ‚ö†Ô∏è
.code testing_in_go/cmd.go /PARALLELFATAL OMIT/,/END OMIT/ 

* t.Parallel() + t.FailNow() ‚ö†Ô∏è
.code testing_in_go/foo_test.go /ASCODE OMIT/,/END OMIT/ HLERR

* testing/*
- testing/iotest
- testing/quick

* net/http/httptest
- type ResponseRecorder
- type Server

* httptest.ResponseRecorder
.code testing_in_go/stdlib/net/http/httptest/example_test.go /RR OMIT/,/END OMIT/ HLR

* httptest.ResponseRecorder
.code testing_in_go/stdlib/net/http/httptest/example_test.go /RR OMIT/,/END OMIT/ HLH

* httptest.ResponseRecorder
.code testing_in_go/stdlib/net/http/httptest/example_test.go /RR OMIT/,/END OMIT/ HLRES

* httptest.Server
.code testing_in_go/stdlib/net/http/httptest/example_test.go /S OMIT/,/END OMIT/ HLS

* httptest.Server
.code testing_in_go/stdlib/net/http/httptest/example_test.go /S OMIT/,/END OMIT/ HLSC

* httptest.Server
.code testing_in_go/stdlib/net/http/httptest/example_test.go /S OMIT/,/END OMIT/ HLURL

* go test

* go test 
.code testing_in_go/cmd.go /GOOKTEST OMIT/,/END OMIT/

* go test -v
.code testing_in_go/cmd.go /GOOKVTEST OMIT/,/END OMIT/

* go test -list
.code testing_in_go/cmd.go /GOTESTLIST OMIT/,/END OMIT/

* go test -run
- go test -run=TestSum
- go test -run="TestSum[3-9]+"

* go test -short
.code testing_in_go/cmd.go /SHORT OMIT/,/END OMIT/

* go test -cover
- -covermode
- -coverpkg
- -coverprofile cover.out
- https://blog.golang.org/cover
: https://blog.golang.org/cover - —Ç–æ–ª—å–∫–æ –ø–æ –ø–∞–∫–µ—Ç—É, —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞, –Ω–µ –ø–æ–ª—É—á–∏—Ç—å –ø–æ –ø—Ä–æ–µ–∫—Ç—É

* go test -c
``
`¬Ø\_(„ÉÑ)_/¬Ø`

* go test -timeout <time.Duration>
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 10 –º–∏–Ω—É—Ç

* go 1.10 üéâ
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- go vet
- go test -failfast
- go test -json
- output
: –≤—ã–≤–æ–¥ stdout & stderr, PAUSE –∏ CONT –≤ Parallel

* –§–∏–∫—Å—Ç—É—Ä—ã

* –§–∏–∫—Å—Ç—É—Ä—ã ‚úÖ
.code testing_in_go/fixture.go /FIXTURE OMIT/,/END OMIT/
: –ø—É—Ç—å –æ—Ç —Ç–µ—Å—Ç–∞

* Golden files ‚úÖ
.code testing_in_go/fixture.go /GOLDEN OMIT/,/END OMIT/ HLUP

* Golden files ‚úÖ
.code testing_in_go/fixture.go /GOLDENRES OMIT/,/END OMIT/ 

* test helpers ‚úÖ
.code testing_in_go/helpers.go /HELPER OMIT/,/END OMIT/ 

* test helpers ‚úÖ
.code testing_in_go/helpers.go /SETUP OMIT/,/END OMIT/ 

* test helpers ‚ùå
.code testing_in_go/helpers.go /WRONG OMIT/,/END OMIT/ HLF

* test helpers ‚ùå
.code testing_in_go/helpers.go /WRONG OMIT/,/END OMIT/ 
.code testing_in_go/helpers.go /WRONGRES OMIT/,/END OMIT/ HLF

* testing.go ‚ö†Ô∏è
- –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –¥—Ä—É–≥–∏—Ö –ø–∞–∫–µ—Ç–∞—Ö
- –≠—Ç–æ –ù–ï —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–¥

* black box 
- package foo_test
: —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

* build tags ‚úÖ
.code testing_in_go/integration.go /FLAG OMIT/,/ENDFLAG OMIT/ 

* build tags ‚úÖ
.code testing_in_go/integration.go /FLAGRUN OMIT/,/END OMIT/ 

* build tags ‚úÖ
- *_integration_test.go
- package integration_test
 
* build tags ‚úÖ
doc.go
.code testing_in_go/integration.go /DOC OMIT/,/END OMIT/ 

* build tags ‚úÖ
.code testing_in_go/runner-pod.yaml /TREE OMIT/,/END OMIT/ HLT

* build tags ‚úÖ
.code testing_in_go/runner-pod.yaml /HELM OMIT/,/END OMIT/ HLCMD

* open source

* go test
.code testing_in_go/cmd.go /GOOKTEST OMIT/,/END OMIT/

* go test -v
.code testing_in_go/cmd.go /GOOKVTEST OMIT/,/END OMIT/

* go test -v
.code testing_in_go/cmd.go /GOFAILVTEST OMIT/,/END OMIT/

* richgo
.link https://github.com/kyoh86/richgo github.com/kyoh86/richgo

* richgo test -v
.code testing_in_go/cmd.go /RICHGOFAILVTEST OMIT/,/END OMIT/

* richgo test -v
.image testing_in_go/richgo.png _ 950

* junit.xml
.link https://github.com/jstemmer/go-junit-report github.com/jstemmer/go-junit-report
.code testing_in_go/cmd.go /JUNIT OMIT/,/END OMIT/

* testify/assert
.link https://github.com/stretchr/testify/ github.com/stretchr/testify/assert 
.code testing_in_go/testify.go /ASSERT OMIT/,/END OMIT/
: Fail

* testify/require
.link https://github.com/stretchr/testify/ github.com/stretchr/testify/require 
.code testing_in_go/testify.go /REQUIRE OMIT/,/END OMIT/
: FailNow

* t.Parallel() + t.FailNow() ‚úÖ
.code testing_in_go/foo_test.go /ASCODETESTIFY OMIT/,/END OMIT/ HLERR

* no testify/assert
.code testing_in_go/testify.go /AST OMIT/,/END OMIT/

* Mocks

* testify/mock
.link https://github.com/stretchr/testify/ github.com/stretchr/testify/mock 

* testify/mock
.code testing_in_go/mocks.go1 /MOCK OMIT/,/END OMIT/ HLM

* minimock
.link https://github.com/gojuno/minimock/ github.com/gojuno/minimock

* minimock
.code testing_in_go/mocks.go1 /MINICMD OMIT/,/END OMIT/

* minimock
.code testing_in_go/mocks.go1 /MINI OMIT/,/END OMIT/ HLF
.code testing_in_go/mocks.go1 /MINIUSE OMIT/,/END OMIT/ HLF

* minimock
.code testing_in_go/mocks.go1 /MINI OMIT/,/END OMIT/ HLF2
.code testing_in_go/mocks.go1 /MINIUSE2 OMIT/,/END OMIT/ HLF2

* go-sqlmock ‚ö†Ô∏è
.link https://github.com/DATA-DOG/go-sqlmock/ github.com/DATA-DOG/go-sqlmock

* go-sqlmock ‚ö†Ô∏è
.code testing_in_go/mocks.go1 /SQL OMIT/,/END OMIT/ HLS

* –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
: –Ø –Ω–µ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–∫ TDD, –Ω–æ —Ç–µ—Å—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–∏—Å–∞—Ç—å –º–Ω–µ –∫–æ–¥ –±—ã—Å—Ç—Ä–µ–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–≥–æ, —á—Ç–æ —è —Ç—É—Ç –ø–æ–Ω–∞–ø–∏—Å–∞–ª, —è –Ω–µ –∑–∞–ø—É—Å–∫–∞—é –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –Ω–µ –ø—Ä–æ—â–µ–ª–∫–∏–≤–∞—é 5 —ç–∫—Ä–∞–Ω–æ–≤ –∏ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é —Å—Ç–æ–ª—å–∫–æ –∂–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫—É—Ä–ª–æ–º, —è –ø—Ä–æ—Å—Ç–æ –ø–∏—à—É —Ç–µ—Å—Ç, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–≤–µ—Ä—è—é –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö, –≤ —Ç–æ–º —á–∏—Å–ª–µ, —Ç–µ —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –Ω–∞ —Ç–æ–º –∫–æ–Ω—Ü–µ –ø—Ä–æ–≤–æ–¥–∞ –∫—Ç–æ-—Ç–æ —É–º–µ—Ä –ø–æ—ç—Ç–æ–º—É —É –º–µ–Ω—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–º–∞–ª–æ —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã, —Ö–æ—Ç—è –º—ã —á–∞—Å—Ç–æ —Å–ª—ã—à–∏–º, —á—Ç–æ —ç—Ç–æ –º–æ–≤–µ—Ç–æ–Ω. –ë–ª–∏–Ω, –Ω—É –≤–æ—Ç —É –º–µ–Ω—è –ø—É–±–ª–∏—á–Ω—ã–π –º–µ—Ç–æ–¥, –≤–Ω—É—Ç—Ä–∏ 3 –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Å–æ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –∏ –±–æ–ª—å—à–∏–º –∫–æ–ª-–≤–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤. –ù—É —è –ª—É—á—à–µ 3 —Ç–µ—Å—Ç–∞ –Ω–∞–ø–∏—à—É –Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∏ –æ–¥–∏–Ω-–¥–≤–∞ –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–π, –Ω–æ –Ω–µ –ø–æ–≥—Ä–µ–±—É —Å–µ–±—è –ø–æ–¥ —Ç–æ–Ω–Ω–æ–π –º–æ–∫–æ–≤ –∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö. 
: –¢–µ—Å—Ç—ã ‚Äì –µ—Ñ—Ä–µ–π—Ç–æ—Ä –≤ –≤–∞—à–µ–º –≤–∑–≤–æ–¥–µ: —Ç–æ—Ç –ø–∞—Ä–µ–Ω—å, —á—Ç–æ –ø—Ä–∏–∫—Ä–æ–µ—Ç —Å–ø–∏–Ω—É, –∫–æ–≥–¥–∞ –≤—ã –∫–∞—Ç–∏—Ç–µ –≤ –±–æ–π –∏ –±—É–¥–µ—Ç –ø–æ–¥–Ω–æ—Å–∏—Ç—å —Å–Ω–∞—Ä—è–¥—ã, –∫–æ–≥–¥–∞ –≤—ã –¥–µ–ª–∞–µ—Ç–µ –Ω–æ–≤—É—é —Ñ–∏—á—É 